name: Publish revnext to PyPI

on:
    push:
        tags:
            - 'revnext-v*'

jobs:
    publish:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-python@v5
              with:
                  python-version: '3.10'
            - name: Install build
              run: pip install build twine
            - name: Build revnext
              run: python -m build
              working-directory: packages/revnext
            - name: Publish to PyPI
              env:
                  TWINE_USERNAME: __token__
                  TWINE_PASSWORD: ${{ secrets.PYPI_API_TOKEN }}
              run: twine upload packages/revnext/dist/*
            - name: Create GitHub Release
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              run: |
                  TAG="${GITHUB_REF#refs/tags/}"
                  gh release create "$TAG" --generate-notes
              if: success()
